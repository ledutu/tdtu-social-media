<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>TDTU</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->
    
    <%- include('layouts/head') %>

</head>

<body>

    <!-- header -->
    <%- include('layouts/header.ejs') %> 

    <main>
        <div class="main-wrapper pt-80">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 order-2 order-lg-1">
                        <aside class="widget-area">
                            <!-- widget single item start -->
                            <div class="card widget-item">
                                <h4 class="widget-title">latest top news</h4>
                                <div class="widget-body">
                                    <ul class="like-page-list-wrapper">
                                    <% for( let i = 0; i < 5; i++ ) { %>
                                    
                                    <li class="unorder-list">
                                        <!-- profile picture end -->

                                        <div class="unorder-list-info">
                                            <h3 class="list-title" width="50px"><a href="#">CNTT</a></h3>
                                            <p class="sub-list">Notification Content</p>
                                            <p class="list-subtitle">2 min ago</p>
                                        </div>
                                    </li>
                                    <% } %>
                                </div>
                            </div>
                            <!-- widget single item end -->
                        </aside>
                    </div>

                    <div class="col-lg-6 order-1 order-lg-2">
                        <!-- share box start -->                        
                        <div class="card card-small">
                            <div class="share-box-inner">
                                <!-- profile picture end -->
                                <div class="profile-thumb">
                                    <a href="#">
                                        <figure class="profile-thumb-middle">
                                            <img src="<%- user.image %> " alt="profile picture">
                                        </figure>
                                    </a>
                                </div>
                                <!-- profile picture end -->

                                <!-- share content box start -->
                                <div class="share-content-box w-100">
                                    <form class="share-text-box" action="" id="articleForm">
                                        <textarea name="article" id="article" class="share-text-field" aria-disabled="true" placeholder="Say Something" data-toggle="modal" data-target="#textbox"></textarea>
                                        <button class="btn-share" type="submit">share</button>
                                    </form>
                                </div>
                                <!-- share content box end -->
                            </div>
                        </div>
                        <!-- share box end -->

                        <div class="timeline-content">
                        <% posts.forEach(post => { %>
                            <div class="card">
                                <!-- post title start -->
                                <div class="post-title d-flex align-items-center">
                                    <!-- profile picture end -->
                                    <div class="profile-thumb">
                                        <a href="#">
                                            <figure class="profile-thumb-middle">
                                                <img src="<%- post.user.image %>" alt="profile picture">
                                            </figure>
                                        </a>
                                    </div>
                                    <!-- profile picture end -->
    
                                    <div class="posted-author">
                                        <h6 class="author"><a href="/user/profile"><%- post.user.full_name %></a></h6>
                                        <span class="post-time"><%- new Date(post.user.createdAt).getHours() + ":" + new Date(post.user.createdAt).getMinutes() +
                                            " " + new Date(post.user.createdAt).getDate() + "/" + new Date(post.user.createdAt).getMonth() + "/" + new Date(post.user.createdAt).getFullYear()%> </span>
                                    </div>
    
                                </div>
                                <!-- post title start -->
                                <div class="post-content">
                                    <p class="post-desc"><%- post.content %></p>
                                    <% if (post.image.length === 1) { %>
                                        <div class="post-thumb-gallery">
                                            <figure class="post-thumb img-popup">
                                                <a href="<%- post.image[0] %>">
                                                    <img src="<%- post.image[0] %>" alt="post image">
                                                </a>
                                            </figure>
                                        </div> 
                                        
                                    <% } else if (post.image.length > 1) { %>
                                        <div class="post-thumb-gallery img-gallery">
                                            <div class="row no-gutters">
                                                <div class="col-8">
                                                    <figure class="post-thumb">
                                                        <a class="gallery-selector" href="<%- post.image[0] %>">
                                                            <img src="<%- post.image[0] %>" alt="post image">
                                                        </a>
                                                    </figure>
                                                </div>
                                                <div class="col-4">
                                                    <div class="row">
                                                        <% for( let i = 1; i < 10; i++ ) { %>
                                                        <div class="col-12" style="display:<%= i >= 4? 'none': '' %>">
                                                            <figure class="post-thumb">
                                                                <a class="gallery-selector" href="<%- post.image[1] %>">
                                                                    <img src="<%- post.image[1] %>" alt="post image">
                                                                </a>
                                                            </figure>
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    
                                    <% } else if (post.youtube_link) { %>
                                        <div class="plyr__video-embed plyr-youtube">
                                            <iframe src="<%- post.youtube_link %>" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                        </div>
                                    <% } %>
                                    
                                    <div class="post-meta">
                                        <button class="post-meta-like">
                                            <i class="bi bi-heart-beat"></i>
                                            <span><%- post.vote_rate || '0' %> </span>
                                            <strong><%- post.vote_rate || '0' %></strong>
                                        </button>
                                        <ul class="comment-share-meta">
                                            <li>
                                                <button class="post-comment">
                                                    <i class="bi bi-chat-bubble"></i>
                                                    <span><%- post.comments.length %> </span>
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                        </div>
                    </div>

                    <div class="col-lg-3 order-3">
                        <aside class="widget-area">
                            <!-- widget single item start -->
                            <div class="card widget-item">
                                <h4 class="widget-title">Your friend</h4>
                                <div class="widget-body">
                                    <ul class="like-page-list-wrapper">
                                        <li class="unorder-list">
                                            <!-- profile picture end -->
                                            <div class="profile-thumb">
                                                <a href="#">
                                                    <figure class="profile-thumb-small">
                                                        <img src="/assets/images/profile/profile-small-33.jpg" alt="profile picture">
                                                    </figure>
                                                </a>
                                            </div>
                                            <!-- profile picture end -->

                                            <div class="unorder-list-info">
                                                <h3 class="list-title"><a href="#">Ammeya Jakson</a></h3>
                                                <p class="list-subtitle"><a href="#">10 mutual</a></p>
                                            </div>
                                            <button class="like-button">
                                                <img class="heart" src="/assets/images/icons/heart.png" alt="">
                                                <img class="heart-color" src="/assets/images/icons/heart-color.png" alt="">
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!-- widget single item end -->
                        </aside>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Scroll to top start -->
    <%- include('layouts/scroll.ejs') %> 
    <!-- Scroll to Top End -->

    <!-- footer listfriend message include footer in here-->
    
    
    <!-- JS
============================================ -->

    <%- include('layouts/javascript.ejs') %>
    
    
    <script>
        $('#articleForm').submit(function(e) {
            e.preventDefault();
            var article = $('#article').val();
            axios.post('http://localhost:3000/postArticle', {
                article
            }).then(response => {
                const post = response.data.data;
                console.log(post)
                    $(".timeline-content").prepend(`<div class="card"> \
                                    <div class="post-title d-flex align-items-center"> \
                                        <!-- profile picture end --> \
                                        <div class="profile-thumb"> \
                                            <a href="#"> \
                                                <figure class="profile-thumb-middle">\
                                                    <img src="`+post.user.image+`" alt="profile picture">\
                                                </figure>\
                                            </a>\
                                        </div>\
                                        <!-- profile picture end -->\
                                        <div class="posted-author">\
                                            <h6 class="author"><a href="/user/profile">`+post.user.full_name+`</a></h6>\
                                            <span class="post-time">`+new Date(post.user.createdAt).getHours() + ":" + new Date(post.user.createdAt).getMinutes() +
                                                " " + new Date(post.user.createdAt).getDate() + "/" + new Date(post.user.createdAt).getMonth() + "/" + new Date(post.user.createdAt).getFullYear()+` </span>\
                                        </div>\
                                    </div>\
                                    <!-- post title start -->\
                                    <div class="post-content">\
                                        <p class="post-desc">`+post.content+`</p>\
                                        <div class="post-meta">\
                                            <button class="post-meta-like">\
                                                <i class="bi bi-heart-beat"></i>\
                                                <span>`+post.vote_rate || '0'+`</span>\
                                                <strong>`+post.vote_rate || '0'`+</strong>\
                                            </button>\
                                            <ul class="comment-share-meta">\
                                                <li>\
                                                    <button class="post-comment">\
                                                        <i class="bi bi-chat-bubble"></i>\
                                                        <span>`+post.comments.length+`</span>\
                                                    </button>\
                                                </li>\
                                            </ul>\
                                        </div>\
                                    </div>\
                                </div>`);
                                
                                $('#article').val(''); 
                                
            }).catch(err => {
                console.log(err)
            })
            // $.ajax({
            //     url: 'http://localhost:3000/postArticle',
            //     type: 'POST',
            //     data: {
            //         article,
            //     },
            //     success: function(data){
            //         console.log(data);
            //     }, 
                
            // });
        })
    </script>

</body>

</html>